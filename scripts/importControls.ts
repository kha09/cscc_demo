// scripts/importControls.ts
import { PrismaClient } from '@prisma/client';
import { parse } from 'csv-parse/sync'; // Using sync version for simplicity in a script

const prisma = new PrismaClient();

// CSV data provided in the prompt
const csvData = `المكون الأساسي,المكون الفرعي ,,,نوع الضابط,رقم الضابط   ,نص الضابط
,,,,,,
١- حوكمة الأمن السيبراني (Cybersecurity Governance),١-١,إستراتيجية الأمن السيبراني (Cybersecurity Strategy),,أساسي,١-١-١,"بالإضافة للضوابط ضمن المكون الفرعي ١-١ في الضوابط الأساسية للأمن السيبراني، يجب أن تضع إستراتيجية الأمن السيبراني للجهة أولوية لدعم حماية الأنظمة الحساسة الخاصة بالجهة."
,١-٢,إدارة مخاطر الأمن السيبراني (Cybersecurity Risk Management),,أساسي,١-٢-١,"بالإضافة للضوابط ضمن المكون الفرعي ١-٥ في الضوابط الأساسية للأمن السيبراني، يجب أن تشمل منهجية إدارة مخاطر الأمن السيبراني بحد أدنى ما يأتي:"
,,,,فرعي,١-٢-١-١,"تنفيذ إجراء تقييم مخاطر الأمن السيبراني، على الأنظمة الحساسة، مرة واحدة سنوياً، على الأقل."
,,,,فرعي,١-٢-١-٢,"إنشاء سجل مخاطر الأمن السيبراني الخاص بالأنظمة الحساسة، ومتابعته مرة شهرياً على الأقل."
,١-٣,"الأمن السيبراني ضمن إدارة المشاريع المعلوماتية والتقنية
(Cybersecurity in Information Technology Projects)",,أساسي,١-٣-١,"بالإضافة للضوابط الفرعية ضمن الضابط ١-٦-٢ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني، لإدارة المشاريع والتغييرات على الأصول المعلوماتية والتقنية للأنظمة الحساسة في جهة، بحد أدنى؛ ما يلي:"
,,,,فرعي,١-٣-١-١,إجراء اختبار التحمل (Stress Testing) للتأكد من سعة المكونات المختلفة.
,,,,فرعي,١-٣-١-٢,التأكد من تطبيق متطلبات استمرارية الأعمال.
,,,,أساسي,١-٣-٢,"بالإضافة للضوابط الفرعية ضمن الضابط ١-٦-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني، لمشاريع تطوير التطبيقات، والبرمجيات الخاصة بالأنظمة الحساسة للجهة، بحد أدنى؛ ما يلي:"
,,,,فرعي,١-٣-٢-١,"إجراء مراجعة أمنية للشفرة المصدرية، قبل إطلاقها (Security Source Code Review)."
,,,,فرعي,١-٣-٢-٢,"تأمين الوصول، والتخزين، والتوثيق للشفرة المصدرية (Source Code) وإصداراتها."
,,,,فرعي,١-٣-٢-٣,تأمين واجهة برمجة التطبيقات (Authenticated API).
,,,,فرعي,١-٣-٢-٤,"النقل الآمن والموثوق للتطبيقات من بيئات الاختبار (Testing Environment) إلى بيئات الإنتاج (Production Environment ) مع حذف أي بيانات، أو هويات، أو كلمات مرور، متعلقة ببيئات الاختبار، قبل النقل."
,١-٤,"المراجعة والتدقيق الدوري للأمن السيبراني
(Cybersecurity Periodical Assessment and Audit)",,أساسي,١-٤-١,"رجوعاً للضابط ١-٨-١ في الضوابط الأساسية للأمن السيبراني، فإنه يجب على الإدارة المعنية بالأمن السيبراني؛ مراجعة تطبيق ضوابط الأمن السيبراني للأنظمة الحساسة، مرة واحدة سنوياً؛ على الأقل. "
,,,,أساسي,١-٤-٢,"رجوعاً للضابط ١-٨-٢ في الضوابط الأساسية للأمن السيبراني، يجب أن تتم مراجعة تطبيق ضوابط الأمن السيبراني للأنظمة الحساسة؛ من قبل أطراف مستقلة عن الإدارة المعنية بالأمن السيبراني من داخل الجهة، مرة واحدة؛ كل ثلاث سنوات على الأقل."
,١-٥,الأمن السيبراني المتعلق بالموارد البشرية (Cybersecurity in Human Resources) ,,أساسي,١-٥-١,"بالإضافة للضوابط الفرعية ضمن الضابط ١-٩-٣ في الضوابط الأساسية للأمن السيبراني، فإنه يجب أن تغطي متطلبات الأمن السيبراني، قبل بدء علاقة العاملين المهنية بالجهة، بحد أدنى؛ ما يلي:"
,,,,فرعي,١-٥-١-١,إجراء المسح الأمني (Screening or Vetting) للعاملين على الأنظمة الحساسة.
,,,,فرعي,١-٥-١-٢,"أن يشغل وظائف الدعم، والتطوير التقني، للأنظمة الحساسة؛ مواطنون ذوو كفاءة عالية."
٢- تعزيز الأمن السيبراني (Cybersecurity Defense),٢-١,إدارة الأصول (Asset Management),,أساسي,٢-١-١,"بالإضافة للضوابط ضمن المكون الفرعي ٢-١ في الضوابط الأساسية للأمن السيبراني، يجب أن تشمل متطلبات الأمن السيبراني لإدارة الأصول المعلوماتية والتقنية، بحد أدنى؛ مايلي:"
,,,,فرعي,٢-١-١-١,"الاحتفاظ بقائمة محدثة سنوياً، لجميع الأصول التابعة للأنظمة الحساسة.  "
,,,,فرعي,٢-١-١-٢,"تحديد ملاك الأصول (Assets Owner) وإشراكهم في دورة حياة إدارة الأصول، التابعة للأنظمة الحساسة."
,٢-٢,إدارة هويات الدخول والصلاحيات (Identity and Access Management)   ,,أساسي,٢-٢-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-٢-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني المتعلقة بإدارة هويات الدخول، والصلاحيات للأنظمة الحساسة في الجهة، بحد أدنى؛ ما يلي: "
,,,,فرعي,٢-٢-١-١,منع الدخول عن بعد من خارج المملكة.
,,,,فرعي,٢-٢-١-٢,"تقييد الدخول عن بعد من داخل المملكة؛ على أن يتم التأكد عن طريق مركز العمليات الأمنية الخاص بالجهة، عند كل عملية دخول؛ ومراقبة الأنشطة المتعلقة بالدخول عن بعد باستمرار. "
,,,,فرعي,٢-٢-١-٣,"التحقق من الهوية متعدد العناصر (Multi-Factor Authentication ""MFA"") لجميع المستفيدين."
,,,,فرعي,٢-٢-١-٤,"التحقق من الهوية متعدد العناصر (Multi-Factor Authentication ""MFA"") للمستخدمين ذوي الصلاحيات الهامة، والحساسة؛ وعلى الأنظمة المستخدمة لإدارة الأنظمة الحساسة المذكورة في الضابط ٢-٣-١-٤ ومتابعتها."
,,,,فرعي,٢-٢-١-٥,"وضع سياسة آمنة لكلمة المرور ذات معايير عالية، وتطبيقها."
,,,,فرعي,٢-٢-١-٦,استخدام الطرق والخوارزميات الآمنة لحفظ ومعالجة كلمات المرور مثل: استخدام دوال الاختزال (Hashing Functions).
,,,,فرعي,٢-٢-١-٧,الإدارة الآمنة لحسابات الخدمات ((Service Account مابين التطبيقات والأنظمة؛ وتعطيل الدخول البشري التفاعلي (Interactive login) من خلالها. 
,,,,فرعي,٢-٢-١-٨,"فيما عدا مشرفي قواعد البيانات (Database Administrators)، يمنع الوصول أو التعامل المباشر لأي مستخدم مع قواعد البيانات؛ ويتم ذلك من خلال التطبيقات فقط، وبناءً على الصلاحيات المخوّل بها؛ مع مراعاة تطبيق حلول أمنية تحد، أو تمنع من اطلاع مشرفي قواعد البيانات على البيانات المصنفة (Classified Data)."
,,,,أساسي,٢-٢-٢,"رجوعاً للضابط ٢-٢-٣-٥ في الضوابط الأساسية للأمن السيبراني، يجب مراجعة هويات الدخول على الأنظمة الحساسة، مرة واحدة، كل ثلاثة أشهر، على الأقل."
,٢-٣,"حماية الأنظمة وأجهزة معالجة المعلومات
(Information System and Processing Facilities Protection)",,أساسي,٢-٣-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-٣-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني لحماية الأنظمة الحساسة، وأجهزة معالجة المعلومات الخاصة بها، بحد أدنى؛ ما يلي:"
,,,,فرعي,٢-٣-١-١,السماح فقط بقائمة محددة من ملفات التشغيل (Whitelisting) للتطبيقات والبرامج؛ للعمل على الخوادم الخاصة بالأنظمة الحساسة.
,,,,فرعي,٢-٣-١-٢,حماية الخوادم الخاصة بالأنظمة الحساسة بتقنيات حماية الأجهزة الطرفية(End-point Protection) المعتمدة لدى الجهة.
,,,,فرعي,٢-٣-١-٣,"تطبيق حزم التحديثات، والإصلاحات الأمنية، مرة واحدة شهرياً على الأقل، للأنظمة الحساسة الخارجية، والمتصلة بالإنترنت؛ وكل ثلاثة أشهر على الأقل، للأنظمة الحساسة الداخلية؛ مع اتباع آليات التغيير المعتمدة لدى الجهة."
,,,,فرعي,٢-٣-١-٤,"تخصيص أجهزة حاسب  (Workstations) للعاملين في الوظائف التقنية، ذات الصلاحيات الهامة والحساسة؛ على أن تكون معزولة في شبكة خاصة، لإدارة الأنظمة (Management Network) وعلى أن لا ترتبط بأي شبكة، أو خدمة أخرى (مثل: خدمة البريد الإلكتروني، الإنترنت)."
,,,,فرعي,٢-٣-١-٥,"تشفير أي وصول إشرافي عبر الشبكة (Non-console Administrative Access) لأي من المكونات التقنية للأنظمة الحساسة، باستخدام خوارزميات، وبروتوكولات التشفير الآمنة."
,,,,فرعي,٢-٣-١-٦,مراجعة إعدادات الأنظمة الحساسة وتحصيناتها  (Secure Configuration and Hardening) كل ستة أشهر على الأقل. 
,,,,فرعي,٢-٣-١-٧,"مراجعة الإعدادات المصنعية (Default Configuration) وتعديلها والتأكد من عدم وجود كلمات مرور ثابتة، وخلفية، وإفتراضية (Hard-Coded, Backdoor and Default Passwords) ما أمكن تطبيقه. "
,,,,فرعي,٢-٣-١-٨,"حماية السجلات، والملفات الحساسة للأنظمة، من الوصول غير المصرح به، أو العبث، أو التغيير، أو الحذف غير المشروع."
,٢-٤,إدارة أمن الشبكات (Networks Security Management),,أساسي,٢-٤-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-٥-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني لإدارة أمن شبكات الأنظمة الحساسة للجهة بحد أدنى ما يلي:"
,,,,فرعي,١-١-٤-٢,"العزل والتقسيم المادي، أو المنطقي، لشبكات الأنظمة الحساسة."
,,,,فرعي,٢-١-٤-٢,"مراجعة إعدادات جدار الحماية (Firewall rules) وقوائمه؛ كل ستة أشهر، على الأقل."
,,,,فرعي,٣-١-٤-٢,"منع التوصيل المباشر، لأي جهاز بالشبكة المحلية للأنظمة الحساسة؛ إلا بعد الفحص، والتأكد من توافر عناصر الحماية المحققة، للمستويات المقبولة للأنظمة الحساسة."
,,,,فرعي,٤-١-٤-٢,منع الأنظمة الحساسة من الاتصال بالشبكة اللاسلكية.
,,,,فرعي,٥-١-٤-٢,الحماية من التهديدات المتقدمة المستمرة على مستوى الشبكة (Network APT).
,,,,فرعي,٦-١-٤-٢,"منع الأنظمة الحساسة من الاتصال بالإنترنت في حال أن كانت تقدم خدمة داخلية للجهة؛ ولا توجد هناك حاجة ضرورية جداً، للدخول على الخدمة من خارج الجهة."
,,,,فرعي,٧-١-٤-٢,"تقديم خدمات الأنظمة الحساسة، من خلال شبكات مستقلة عن الإنترنت، في حال أن كانت خدمات تلك الأنظمة، موجهة لجهات محدودة؛ وليست للأفراد.   "
,,,,فرعي,٨-١-٤-٢,"الحماية من هجمات تعطيل الشبكات (""Distrbuted Denial of Service Attack ""DDoS) للحد من المخاطر الناتجة عن هجمات تعطيل الشبكات."
,,,,فرعي,٩-١-٤-٢,"السماح بقائمة محددة (Whitelisting) فقط، لقوائم جدار الحماية، الخاصة بالأنظمة الحساسة. "
,٢-٥,أمن الأجهزة المحمولة (Mobile Devices Security) ,,أساسي,٢-٥-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-٦-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني، الخاصة بأمن الأجهزة المحمولة، وأجهزة (BYOD) للجهة، بحد أدنى؛ ما يلي:"
,,,,فرعي,١-١-٥-٢,"منع الوصول من الأجهزة المحمولة للأنظمة الحساسة، إلا لفترة مؤقتة فقط؛ وذلك بعد إجراء تقييم المخاطر، وأخذ الموافقات اللازمة من الإدارة المعنية بالأمن السيبراني في الجهة."
,,,,فرعي,٢-١-٥-٢,"تشفير أقراص الأجهزة المحمولة، ذات صلاحية الوصول للأنظمة الحساسة، تشفيراً كاملاً (Full Disk Encryption)."
,٢-٦,حماية البيانات والمعلومات (Data and Information Protection),,أساسي,٢-٦-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-٧-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني لحماية البيانات والمعلومات؛ بحد أدنى، ما يلي: "
,,,,فرعي,١-١-٦-٢,عدم استخدام بيانات الأنظمة الحساسة في غير بيئة الإنتاج (Production Environment) إلا بعد استخدام ضوابط مشددة لحماية تلك البيانات مثل: تقنيات تعتيم البيانات (Data Masking) أو تقنيات مزج البيانات (Data Scrambling).  
,,,,فرعي,٢-١-٦-٢,تصنيف جميع بيانات الأنظمة الحساسة.
,,,,فرعي,٣-١-٦-٢,"حماية البيانات المصنفة الخاصة بالأنظمة الحساسة من خلال تقنيات، منع تسريب البيانات (Data Leakage Prevention)."
,,,,فرعي,٤-١-٦-٢,"تحديد مدة الاحتفاظ المطلوبة (Retention Period) لبيانات الأعمال المتعلقة بالأنظمة الحساسة؛ حسب التشريعات ذات العلاقة، ويتم الاحتفاظ بالبيانات المطلوبة فقط، في بيئات الإنتاج للأنظمة الحساسة. "
,,,,فرعي,٥-١-٦-٢,منع نقل أي من بيانات بيئة الإنتاج الخاصة بالأنظمة الحساسة إلى أي بيئة أخرى.
,٢-٧,التشفير (Cryptography),,أساسي,٢-٧-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-٨-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني للتشفير، بحد أدنى، ما يلي: "
,,,,فرعي,١-١-٧-٢,تشفير جميع بيانات الأنظمة الحساسة؛ أثناء النقل (Data-In-Transit).
,,,,فرعي,٢-١-٧-٢,"تشفير جميع بيانات الأنظمة الحساسة؛ أثناء التخزين (Data-At-Rest) على مستوى الملفات، أو قاعدة البيانات، أو على مستوى أعمدة محددة، داخل قاعدة البيانات."
,,,,فرعي,٣-١-٧-٢,استخدام طرق وخوارزميات ومفاتيح وأجهزة تشفير محدثة وآمنة وفقاً لما تصدره الهيئة بهذا الشأن.
,٢-٨,إدارة النسخ الاحتياطية (Backup and Recovery Management),,أساسي,٢-٨-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-٩-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني لإدارة النسخ الاحتياطية، بحد أدنى؛ ما يلي: "
,,,,فرعي,١-١-٨-٢,"نطاق عمل النسخ الاحتياطي المتصل، وغير المتصل (Online and Offline backup) ليشمل جميع الأنظمة الحساسة. "
,,,,فرعي,٢-١-٨-٢,"عمل النسخ الاحتياطي على فترات زمنية مخطط لها؛ بناءً على تقييم المخاطر للجهة. وتوصي الهيئة بأن يتم عمل النسخ الاحتياطي، للأنظمة الحساسة، بشكل يومي. "
,,,,فرعي,٣-١-٨-٢,"تأمين الوصول، والتخزين، والنقل لمحتوى النسخ الاحتياطية للأنظمة الحساسة ووسائطها، وحمايتها من الإتلاف، أو التعديل، أو الاطلاع غير المصرح به."
,,,,أساسي,٢-٨-٢,"رجوعاً للضابط ٢-٩-٣-٣ في الضوابط الأساسية للأمن السيبراني، يجب إجراء فحص دوري؛ كل ثلاثة أشهر على الأقل، لتحديد مدى فعالية استعادة النسخ الاحتياطية، الخاصة بالأنظمة الحساسة."
,٢-٩,إدارة الثغرات (Vulnerabilities Management),,أساسي,٢-٩-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-١٠-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني لإدارة الثغرات للأنظمة الحساسة، بحد أدنى، ما يلي: "
,,,,فرعي,١-١-٩-٢,استخدام وسائل وأدوات موثوقة لإكتشاف الثغرات.
,,,,فرعي,٢-١-٩-٢,"تقييم الثغرات ومعالجتها (بتنصيب حزم التحديثات والإصلاحات) على المكونات التقنية للأنظمة الحساسة، مرة واحدة شهرياً، على الأقل، للأنظمة الحساسة الخارجية، والمتصلة بالإنترنت؛ وكل ثلاثة أشهر على الأقل، للأنظمة الحساسة الداخلية."
,,,,فرعي,٣-١-٩-٢,"معالجة فورية للثغرات الحرجة (Critical Vulnerabilities) المكتشفة حديثاً؛ مع اتباع آليات إدارة التغيير، المعتمدة لدى الجهة."
,,,,أساسي,٢-٩-٢,"رجوعاً للضابط ٢-١٠-٣-١ في الضوابط الأساسية للأمن السيبراني، يجب فحص الثغرات واكتشافها على المكونات التقنية، للأنظمة الحساسة، مرة واحدة شهرياً؛ على الأقل."
,٢-١٠,اختبار الاختراق (Penetration Testing),,أساسي,٢-١٠-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-١١-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني لاختبار الاختراق للأنظمة الحساسة، بحد أدنى؛ ما يلي: "
,,,,فرعي,١-١-١٠-٢,"نطاق عمل اختبار الاختراق، ليشمل جميع المكونات التقنية للأنظمة الحساسة، وجميع الخدمات المقدمة داخلياً وخارجياً. "
,,,,فرعي,٢-١-١٠-٢,عمل اختبار الاختراق من قبل فريق مؤهل. 
,,,,أساسي,٢-١٠-٢,"رجوعاً للضابط ٢-١١-٣-٢ في الضوابط الأساسية للأمن السيبراني، يجب عمل اختبار الاختراق على الأنظمة الحساسة، كل ستة أشهر؛ على الأقل. "
,٢-١١,"إدارة سجلات الأحداث ومراقبة الأمن السيبراني
(Cybersecurity Event Logs and Monitoring Management)",,أساسي,٢-١١-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-١٢-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات إدارة سجلات الأحداث، ومراقبة الأمن السيبراني للأنظمة الحساسة، بحد أدنى؛ ما يلي:"
,,,,فرعي,١-١-١١-٢,تفعيل سجلات الأحداث (Event logs) الخاصة بالأمن السيبراني؛ على جميع المكونات التقنية للأنظمة الحساسة.
,,,,فرعي,٢-١-١١-٢,تفعيل التنبيهات وسجلات الأحداث المتعلقة بإدارة تغييرات الملفات (File Integrity Management) ومراقبتها. 
,,,,فرعي,٣-١-١١-٢,"مراقبة سلوك المستخدم (""User Behavior Analytics ""UBA) وتحليله."
,,,,فرعي,٤-١-١١-٢,"مراقبة سجلات الأحداث، الخاصة بالأنظمة الحساسة على مدار الساعة."
,,,,فرعي,٥-١-١١-٢,"الاحتفاظ بسجلات الأحداث، الخاصة بالأمن السيبراني، المتعلقة بالأنظمة الحساسة وحمايتها؛ على أن تكون شاملة، ومتضمنة للتفاصيل كاملة (مثل: الوقت، التاريخ، الهوية، النظام المتأثر)."
,,,,أساسي,٢-١١-٢,"رجوعاً للضابط ٢-١٢-٣-٥ في الضوابط الأساسية للأمن السيبراني، يجب أن لا تقل مدة الاحتفاظ بسجلات الأحداث الخاصة بالأمن السيبراني، على الأنظمة الحساسة عن ١٨ شهراً؛ حسب المتطلبات التشريعية، والتنظيمية، ذات العلاقة."
,٢-١٢,"حماية تطبيقات الويب (Web Application Security)
",,أساسي,٢-١٢-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٢-١٥-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني، لحماية تطبيقات الويب الخارجية للأنظمة الحساسة للجهة، بحد أدنى؛ ما يلي:"
,,,,فرعي,١-١-١٢-٢,"الإدارة الآمنة للجلسات (Secure Session Management)، ويشمل موثوقية الجلسات (Authenticity)، وإقفالها (Lockout)، وإنهاء مهلتها (Timeout )."
,,,,فرعي,٢-١-١٢-٢,تطبيق معايير أمن التطبيقات وحمايتها (OWASP Top Ten) في حدها الأدنى.
,,,,أساسي,٢-١٢-٢,"رجوعاً للضابط ٢-١٥-٣-٢ في الضوابط الأساسية للأمن السيبراني، يجب استخدام مبدأ المعمارية ذات المستويات المتعددة (Multi-tier Architecture) على أن لا يقل عدد المستويات عن ٣ (3-Tier Architecture)."
,٢-١٣,حماية التطبيقات (Application Security),,أساسي,٢-١٣-١,يجب تحديد وتوثيق واعتماد متطلبات الأمن السيبراني لحماية التطبيقات الداخلية الخاصة بالأنظمة الحساسة للجهة من المخاطر السيبرانية.
,,,,أساسي,٢-١٣-٢,"يجب تطبيق متطلبات الأمن السيبراني؛ لحماية التطبيقات الداخلية، الخاصة بالأنظمة الحساسة للجهة."
,,,,أساسي,٢-١٣-٣,"يجب أن تغطي متطلبات الأمن السيبراني؛ لحماية التطبيقات الداخلية، الخاصة بالأنظمة الحساسة للجهة، بحد أدنى، ما يلي:"
,,,,فرعي,١-٣-١٣-٢,استخدام مبدأ المعمارية ذات المستويات المتعددة (Multi-tier Architecture) على أن لا يقل عدد المستويات عن ٣ (3-Tier Architecture). 
,,,,فرعي,٢-٣-١٣-٢,استخدام بروتوكولات آمنة (مثل بروتوكول HTTPS).
,,,,فرعي,٣-٣-١٣-٢,توضيح سياسة الاستخدام الآمن للمستخدمين.
,,,,فرعي,٤-٣-١٣-٢,"الإدارة الآمنة للجلسات (Secure Session Management)، ويشمل موثوقية الجلسات (Authenticity)، وإقفالها (Lockout)، وإنهاء مهلتها (Timeout)."
,,,,أساسي,٢-١٣-٤,مراجعة متطلبات الأمن السيبراني لحماية التطبيقات الداخلية الخاصة بالأنظمة الحساسة للجهة دورياً.
٣- صمود الأمن السيبراني (Cybersecurity Resilience),٣-١,"جوانب صمود الأمن السيبراني في إدارة استمرارية الأعمال
  (Cybersecurity Resilience aspects of Business Continuity Management  - BCM)",,أساسي,٣-١-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٣-١-٣ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي إدارة استمرارية الأعمال في الجهة، بحد أدنى؛ ما يلي:"
,,,,فرعي,١-١-١-٣,وضع مركز للتعافي من الكوارث للأنظمة الحساسة.
,,,,فرعي,٢-١-١-٣,إدراج الأنظمة الحساسة؛ ضمن خطط التعافي من الكوارث.
,,,,فرعي,٣-١-١-٣,"إجراء اختبارات دورية؛ للتأكد من فعالية خطط التعافي، من الكوارث للأنظمة الحساسة، مرة واحدة سنوياً؛ على الأقل."
,,,,فرعي,٤-١-١-٣,توصي الهيئة بإجراء اختبار دوري حي؛ للتعافي من الكوارث (Live DR Test) للأنظمة الحساسة.
"٤- الأمن السيبراني المتعلق بالأطراف الخارجية والحوسبة السحابية
    (Third-Party and Cloud Computing Cybersecurity)",٤-١,"الأمن السيبراني المتعلق بالأطراف الخارجية 
(Third-Party Cybersecurity)",,أساسي,٤-١-١,"بالإضافة للضوابط ضمن المكون الفرعي ٤-١ في الضوابط الأساسية للأمن السيبراني، يجب أن تغطي متطلبات الأمن السيبراني، المتعلقة بالأطراف الخارجية، بحد أدنى؛ ما يلي:  "
,,,,فرعي,١-١-١-٤,"إجراء المسح الأمني (Screening or Vetting) لشركات خدمات الإسناد، ولموظفي خدمات الإسناد، والخدمات المدارة العاملين على الأنظمة الحساسة."
,,,,فرعي,٢-١-١-٤,"أن تكون خدمات الإسناد، والخدمات المدارة على الأنظمة الحساسة؛ عن طريق شركات، وجهات وطنية؛ وفقًا للمتطلبات التشريعية، والتنظيمية ذات العلاقة."
,٤-٢,"الأمن السيبراني المتعلق بالحوسبة السحابية والاستضافة
(Cloud Computing and Hosting Cybersecurity)",,أساسي,٤-٢-١,"بالإضافة للضوابط الفرعية ضمن الضابط ٤-٢-٣ في الضوابط الأساسية للأمن السيراني، يجب أن تغطي متطلبات الأمن السيبراني الخاصة باستخدام خدمات الحوسبة السحابية والاستضافة، بحد أدنى؛ ما يلي: "
,,,,فرعي,١-١-٢-٤,"أن يكون موقع استضافة الأنظمة الحساسة، أو أي جزء من مكوناتها التقنية، داخل الجهة، أو في خدمات الحوسبة السحابية، المقدمة من قبل جهات حكومية، أو شركات وطنية محققة لضوابط الحوسبة السحابية الصادرة من الهيئة مع مراعاة تصنيف البيانات المستضافة. "
`;

// Helper function to safely trim strings, handling potential undefined values
const safeTrim = (str: string | undefined): string => (str ? str.trim() : '');

async function main() {
  console.log(`Start seeding Controls...`);

  // Parse the CSV data
  // Skip the first two lines (header and empty line)
  const records = parse(csvData, {
    columns: false,
    skip_empty_lines: true,
    from_line: 3, // Start parsing from the third line
  });

  const controlsToCreate: {
    mainComponent: string;
    subComponent?: string;
    controlType: string;
    controlNumber: string;
    controlText: string;
  }[] = [];

  let currentMainComponent = '';

  for (const record of records) {
    const mainComponentRaw = safeTrim(record[0]);
    const subComponentRaw = safeTrim(record[1]);
    // Columns 2 and 3 are empty in the provided CSV structure for controls
    const controlTypeRaw = safeTrim(record[4]);
    const controlNumberRaw = safeTrim(record[5]);
    const controlTextRaw = safeTrim(record[6]);

    // Update currentMainComponent if a new one is found
    if (mainComponentRaw) {
      currentMainComponent = mainComponentRaw;
    }

    // Only create a record if essential fields (controlNumber, controlText, controlType) are present
    if (controlNumberRaw && controlTextRaw && controlTypeRaw) {
      controlsToCreate.push({
        mainComponent: currentMainComponent, // Use the tracked main component
        subComponent: subComponentRaw || undefined, // Use raw subcomponent, set undefined if empty
        controlType: controlTypeRaw,
        controlNumber: controlNumberRaw,
        controlText: controlTextRaw,
      });
    } else {
       // Optional: Log skipped rows for debugging
       // console.log(`Skipping row due to missing data: ${record.join(',')}`);
    }
  }

  if (controlsToCreate.length > 0) {
    // Delete existing controls first to avoid conflicts if the script is run multiple times
    // Be cautious with this in production environments
    console.log('Deleting existing controls...');
    await prisma.control.deleteMany({}); // Clear the table before seeding

    console.log(`Creating ${controlsToCreate.length} controls...`);
    // Use createMany for efficiency
    const result = await prisma.control.createMany({
      data: controlsToCreate,
      // skipDuplicates: true, // Not supported for SQLite
    });
    console.log(`Created ${result.count} new controls.`);
  } else {
    console.log('No valid control records found in the CSV data.');
  }

  console.log(`Seeding finished.`);
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
